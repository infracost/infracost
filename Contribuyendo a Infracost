Contribuyendo a Infracost
游뗿Gracias por contribuir y unirse a nuestra misi칩n de ayudar a los ingenieros a utilizar la infraestructura de la nube de manera econ칩mica y eficiente.游.

칔nase a nuestro canal comunitario de Slack , somos un grupo amigable y estamos felices de ayudarlo a comenzar :)

Tabla de contenido
Descripci칩n general
Configuraci칩n del entorno de desarrollo
Instalar
Correr
Prueba
Pruebas unitarias
Pruebas de integraci칩n
Construir
Adici칩n de nuevos recursos
Credenciales de Azure
Consultando la API de GraphQL
Revisiones de c칩digo
Descripci칩n general
El proceso general para contribuir a Infracost es:

Revisa el tablero de proyectos para ver si hay algo en lo que te gustar칤a trabajar; estos son los temas en los que nos gustar칤a centrarnos en un futuro pr칩ximo. Las etiquetas de problemas deber칤an ayudarlo a encontrar un problema en el que trabajar. Tambi칠n hay otros temas y debates que le gustar칤a consultar.
Cree un problema nuevo si no hay ning칰n problema en el que desee trabajar. Indique todos los detalles que considere necesarios, el contexto del caso de uso es especialmente 칰til si desea recibir buenos comentarios.
Agregue un comentario al problema en el que est치 trabajando para que el resto de la comunidad lo sepa.
Cree una bifurcaci칩n, confirme y empuje a su bifurcaci칩n. Env칤a una solicitud de extracci칩n (PR) desde tu bifurcaci칩n a este repositorio con el cambio propuesto. No te olvides de correr make linty make fmtprimero. Incluya pruebas unitarias y de integraci칩n cuando corresponda. Usamos confirmaciones convencionales . Los mensajes de confirmaci칩n generalmente pueden comenzar con "feat(aws): add...", "feat(google): add...", "fix: nil pointer...", "docs: Explain...", o "tarea: corregir error tipogr치fico". Esto nos ayuda a generar un registro de cambios m치s limpio.
Si es su primer PR en la organizaci칩n de Infracost, un bot dejar치 un comentario pidi칠ndole que siga un paso r치pido para firmar nuestro Acuerdo de licencia de colaborador.
Revisaremos su cambio y le proporcionaremos comentarios.
Configuraci칩n del entorno de desarrollo
Esta gu칤a asume que est치 familiarizado con Terraform, si no, puede tomarse una hora para leer/ver esto y esto .

Instalar
Suponiendo que ya ha instalado go , instale las dependencias de go

make deps
Correr
Ejecute el c칩digo:

make run ARGS="breakdown --path examples/terraform --usage-file=examples/terraform/infracost-usage.yml"
Esto utilizar치 su clave API de Infracost existente; reg칤strese para obtener una clave de clave de API gratuita si a칰n no tiene una.

Prueba
Pruebas unitarias
Para ejecutar solo las pruebas unitarias:

make test
Pruebas de integraci칩n
Debe ejecutar pruebas con el -vnivel de registro de bandera y advertencia para que pueda ver y corregir cualquier advertencia:

INFRACOST_LOG_LEVEL=warn go test -v -cover ./internal/providers/terraform/aws/ebs_volume_test.go

time="2021-04-05T15:24:16Z" level=warning msg="Multiple prices found for aws_ebs_volume.gp3 Provisioned throughput, using the first price"
Para ejecutar todas las pruebas para un proveedor de nube espec칤fico:

make test_aws
make test_google
make test_azure
Para ejecutar todas las pruebas, puede utilizar:

make test_all
Los archivos dorados de prueba se pueden actualizar para todas las pruebas o para un proveedor de nube espec칤fico:

make test_update
make test_update_aws
make test_update_google
make test_update_azure # see the Azure credentials section below
Construir
make build
Adici칩n de nuevos recursos
춰 Consulte nuestra gu칤a dedicada para agregar recursos!

Credenciales de Azure
Trabajar en recursos de Azure requiere credenciales de Azure, ya que el proveedor de Azure Terraform requiere credenciales reales para poder ejecutarse terraform plan. Esto significa que debe tener credenciales de Azure para ejecutar los comandos de Infracost y las pruebas de integraci칩n para Azure. Recomendamos crear credenciales de Azure de solo lectura para este fin. Si tiene una suscripci칩n de Azure, puede hacerlo ejecutando la azl칤nea de comando:

az ad sp create-for-rbac --name http://InfracostReadOnly --role Reader --scope=/subscriptions/<SUBSCRIPTION ID> --years=10
Si no tiene una suscripci칩n de Azure, pregunte en el canal de colaboradores en Infracost Slack y podemos proporcionarle las credenciales.

Para ejecutar las pruebas de integraci칩n de Azure en la acci칩n de GitHub en las solicitudes de incorporaci칩n de cambios, estas credenciales tambi칠n deben agregarse a los secretos de su bifurcaci칩n. Para hacer esto:

Ir https://github.com/<YOUR GITHUB NAME>/infracost/settings/secrets/actionsa
Agregue secretos de repositorio para ARM_SUBSCRIPTION_ID, ARM_TENANT_IDy .ARM_CLIENT_IDARM_CLIENT_SECRET
Consultando la API de GraphQL
Use una extensi칩n de navegador como modheader para permitirle especificar encabezados adicionales en su navegador.
Vaya a https://pricing.api.infracost.io/graphql
Configure su X-API-Keyuso de la extensi칩n del navegador
Ejecute consultas GraphQL para encontrar los productos correctos. Se pueden encontrar ejemplos aqu칤: https://github.com/infracost/cloud-pricing-api/tree/master/examples/queries
La API de precios de GraphQL limita la cantidad de resultados devueltos a 1000, lo que puede limitar su utilidad para explorar los datos. AWS utiliza muchos acr칩nimos, as칤 que aseg칰rese de buscarlos tambi칠n, por ejemplo, "ES" devuelve "AmazonES" para ElasticSearch.

Revisiones de c칩digo
Aqu칤 hay una lista de cosas que debemos buscar durante la revisi칩n del c칩digo al agregar nuevos recursos:

쮼l archivo infracost-usage-example.yml est치 actualizado con nuevos par치metros y descripciones del archivo de uso?
Algunos errores comunes que se descubren en las revisiones:
comparaciones de cadenas sensibles a may칰sculas y min칰sculas: d.Get("kind") ==debe serstrings.ToLower(d.Get("kind").String()) ==
Regex sensible a may칰sculas y min칰sculas en los filtros de precios: ValueRegex: strPtr(fmt.Sprintf("/%s/", deviceType))debe serValueRegex: strPtr(fmt.Sprintf("/%s/i", deviceType))
anclas faltantes en la expresi칩n regular del filtro de precios: fmt.Sprintf("/%s/", x)cu치ndo deber칤a serfmt.Sprintf("/^%s$/", x)
may칰sculas de salida incorrectas: 較덕 Los datos ingeridos deben ser 較덕 Los datos ingeridos
unidad mal llamada: GB-monthdebe serGB
쮸lguna l칤nea de "Precios faltantes" o "Precios m칰ltiples" cuando se ejecuta con --log-level debug?
쮸lg칰n precio o c치lculo incorrecto?
 Alguna p치gina de documentos necesita ser actualizada? por ejemplo, las p치ginas de recursos admitidos . Si es as칤, abra un PR para que pueda fusionarse despu칠s de que se publique la CLI.
